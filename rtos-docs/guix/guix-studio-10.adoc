////

 Copyright (c) Microsoft
 Copyright (c) 2024-present Eclipse ThreadX contributors
 
 This program and the accompanying materials are made available 
 under the terms of the MIT license which is available at
 https://opensource.org/license/mit.
 
 SPDX-License-Identifier: MIT
 
 Contributors: 
     * Frédéric Desbiens - Initial AsciiDoc version.

////

= Chapter 10: Example Project
:description: This chapter describes how to create an example project in GUIX Studio and execute the example on GUIX.

This chapter describes how to create an example project in GUIX Studio and execute the example on GUIX.

== Create New Project

The first step is creating a new project and configuring the displays and languages that the project will support. When you first start GUIX Studio, you will see the *_Recent Projects_* screen:

image::./media/guix-studio/recent_projects.png[Screenshot of the GUIX Studio Recent Projects dialog.]

*Figure 10.1*

Click on the *_Create New Project_*... button to begin a new project. You will be presented with the *_New GUIX Project_* dialog, shown here:

image::./media/guix-studio/create_new_project.png[Screenshot of the GUIX Studio Create New Project dialog.]

*Figure 10.2*

Type the name "*_new_example_*" as the project name. Project names should use standard C variable naming rules, that is, no special or reserved characters. Type the path to the location where the project should be saved. The path must be a valid file system directory, that is, GUIX Studio will not create the directory if it does not exist. Click "OK" to create the project.

The next screen shown is the Project Configuration screen, shown here:

image::./media/guix-studio/config_new_project.png[Screenshot of the GUIX Studio Configure Project dialog.]

*Figure 10.3*

This dialog allows you to specify how many displays your project will support, and give a name to each display. You must specify the color format supported by each display, and optionally type a pathname for the output files generated by Studio for each display. The default directory for the output files is "*_.\_*", meaning the C output files are written to the same directory as the project itself.

For this example, leave the *_Number of Displays_* set to "1", type the name "*_main_display_*" in the display name field, and check "*_allocate canvas memory_*". Leave the resolution, color format, and directory fields at their default values, and click *_OK_*.

You should now see your project open with the Studio IDE, as shown in figure 10.4:

image::./media/guix-studio/initial_screen.png[Screenshot of a project open with the Studio IDE.]

*Figure 10.4*

When you create a new project, GUIX Studio automatically creates a default window as the starting point for your project. This gray box is the default window created for you, centered within the _Target View_.

If this window is not selected, click on the window so that the dashed selection box is drawn around the window. Now in the *_Properties View_*, change the *_Widget Name_*, *_Widget Id_*, *_Left_*, *_Top_*, *_Width_*, *_Height_*, and *_Border_* to match those settings shown below. As you make these changes, you should see your changes immediately taking effect within the Target View.

image::./media/guix-studio/initial_window_properties.png[Screenshot of the Properties View dialog.]

*Figure 10.5*

Next we will add a pixelmap resource to be used within a *_GX_ICON_* widget. Several icons are provided with your GUIX Studio distribution that will work fine for this example. Expand your *_Pixelmaps_* Resource View and click the *_Add New Pixelmap_* button:

image::./media/guix-studio/image74.jpg[Screenshot of the Add New Pixelmap button.]

Browse to your GUIX Studio installation folder, and within the *_./graphics/icons_* folder select the file named *_i_history_lg.png_*. Click *_Open_* to add this resource to your project. Your *_Pixelmaps_* Resource View should now show a preview of the newly added icon image:

image::./media/guix-studio/example_add_pixelmap.png[Screenshot of the Pixelmaps Resource View.]

*Figure 10.6*

We will use this new image resource later as part of our UI design.

Similar to adding a pixelmap resource, we will add a new font resource to our toolbox so that we can use this font later in our design. Expand the *_Fonts_* Resource View and click on the *_Add New Font_* button. This action will invoke the *_Add/Edit_* font dialog. Next, browse to the supplied GUIX fonts in the GUIX Studio installation folder, *_.\fonts\verasans_*, and select the TrueType font file named *_VeraIt.ttf_*. Type font the font name "*_MEDIUM_ITALIC_*" in the font name field, and type "*_30_*" in the height field. Your dialog should now look like this:

image::./media/guix-studio/example_add_font.png[Screenshot of the Edit Font dialog.]

*Figure 10.7*

Click *_OK_* to add this font to your project. You should now see the font in your Resource View:

image::./media/guix-studio/example_font_added.png[Screenshot of the Fonts in the Resource View.]

*Figure 10.8*

We will use this new font later in our UI design.

Now that we have some new resources available, we need to add some child widgets to our screen that can utilize these resources. Select the previously created window named "*_hello_world_*" by right-clicking on the window in the Target View. In the pop-up menu that is now displayed, select the menu command *_Insert, Text, Prompt_* to insert a new *_GX_PROMPT_* widget and attach the widget to the background window. Your window should now look like this:

image::./media/guix-studio/image78.jpg[Screenshot of a pop-up menu with the Prompt selection]

*Figure 10.9*

Click on the font named "*_MEDIUM_ITALIC_*" in the *_Fonts_* Resource View, and drag and drop the font on the prompt widget. Next, edit the prompt properties as shown in figure 10.10 to resize the prompt, set the prompt transparency, and change the prompt text and style:

image::./media/guix-studio/image79.jpg[Screenshot of the Properties View for the prompt.]

*Figure 10.10*

You may need to scroll vertically in the Properties View to see each of these settings depending on your screen resolution. After making these changes, your Target View should now look like this:

image::./media/guix-studio/image80.jpg[Screenshot of a pop-up menu with the Hello World selection.]

*Figure 10.11*

Next we will place an Icon Button style widget on the screen. Select the background window by clicking on it, and use either the top-level menu or the right-click pop-up menu to select *_Insert, Button, Icon Button_* to add a new *_GX_ICON_BUTTON_* to the window. Click on the Icon named *_I_HISTORY_LG_* that we added earlier and drag it to the icon button. Using the properties view, adjust the icon position and size as show below:

image::./media/guix-studio/image81.jpg[Screenshot of the Properties View for the icon button style widget.]

*Figure 10.12*

Your screen should now look like this:

image::./media/guix-studio/image82.jpg[Screenshot of a pop-up menu with the Hello World and clipboard icon.]

*Figure 10.13*

We will call this complete for the simple example screen design. Your actual application screens will likely be much more sophisticated, but this is enough to show you how to use GUIX Studio to create your own application screens.

== Generate Resource and Application Code

The next step is to generate the resource file and specification file that define the embedded GUIX run-time UI. To generate your output files you will need right-click on the *_main_display_* node in the Project View, and select the *_Generate Resource Files_* command. You will observe an information window that indicates your resource files have been generated, as shown in figure 10.14:

image::./media/guix-studio/image83.jpg[Screenshot of a notification dialog.]

*Figure 10.14*

Click *_OK_* to dismiss this notification, and use the same procedure to right-click on the *_main_display_* node and select the *_Generate Specification Files_* command. You should observe a similar notification window. You have now generated your simple UI application files.

== Create User Supplied Code

The next step is to create your own application file that will invoke the GUIX Studio-generated screen design. Using your preferred editor, create a source file named *_new_example.c_*, and enter the following source code into this file:

[,C]
----

/* This is an example of the GUIX graphics framework in Win32. */
/* Include system files. */

#include <stdio.h>
#include "tx_api.h"
#include "gx_api.h"

/* Include GUIX resource and specification files for example. */

#include "new_example_resources.h"
#include "new_example_specifications.h"

/* Define the new example thread control block and stack. */

TX_THREAD new_example_thread;
UCHAR new_example_thread_stack[4096];

/* Define the root window pointer. */

GX_WINDOW_ROOT *root_window;

/* Define function prototypes. */

VOID new_example_thread_entry(ULONG thread_input);
UINT win32_graphics_driver_setup_24bpp(GX_DISPLAY *display);

int main()
{
    /* Enter the ThreadX kernel. */
    tx_kernel_enter();
    return(0);
}

VOID tx_application_define(void *first_unused_memory)
{
    /* Create the new example thread. */
    tx_thread_create(&new_example_thread, "GUIX New Example Thread",
                      new_example_thread_entry, 0,
                      new_example_thread_stack, sizeof(new_example_thread_stack),
                      1, 1, TX_NO_TIME_SLICE, TX_AUTO_START);
}

VOID new_example_thread_entry(ULONG thread_input)
{

    /* Initialize the GUIX library */
    gx_system_initialize();

    /* Configure the main display. */
    gx_studio_display_configure(MAIN_DISPLAY,                      /* Display to configure*/
                                win32_graphics_driver_setup_24bpp, /* Driver to use */
                                LANGUAGE_ENGLISH,                  /* Language to install */
                                MAIN_DISPLAY_DEFAULT_THEME,        /* Theme to install */
                                &root_window);                     /* Root window pointer */

    /* Create the screen - attached to root window. */

    gx_studio_named_widget_create("hello_world", (GX_WIDGET *) root_window, GX_NULL);

    /* Show the root window to make it visible. */
    gx_widget_show(root_window);

    /* Let GUIX run. */
    gx_system_start();

}
----

The source code above creates a typical ThreadX thread named `GUIX New Example Thread` with a stack size of 4K bytes. The interesting work begins in the function named *_new_example_thread_entry_*. This function is where the GUIX specific thread begins to run.

The first call is to the function named *_gx_system_initialize_*. This call is always required before any other GUIX APIs are invoked to prepare the GUIX library for first use.

Next, the example calls the function *_gx_studio_display_configure_*. This function creates the GUIX display instance, installs the requested language of the application string table, installs the requested theme from the display resources, and returns a pointer to the root window that has been created for this display. The root window is used as the parent of all top-level screens that our application will display.

Next the example calls *_gx_studio_named_widget_create_* to create an instance of our *_hello_world_* screen. This function uses the data structures and resource produces by GUIX Studio to create an instance of the screen as we have defined it. We pass the root window pointer as the second parameter to this function call, meaning we want the screen to be immediately attached to the root window. The last parameter is an optional return pointer that can be used if we want to keep a pointer to the created screen.

Next *_gx_widget_show_* is called, which makes the root window and all of its children, including the *_hello_world_* screen, visible.

Finally, the example calls *_gx_system_start_*. This function begins executing the GUIX system event processing loop.

== Build and Run the Example

Building and running the example is specific to your build tools and environment. However we can define the general process:

. Create a new directory and application project
. Add these files to the project:
+
*new_example_resources.c*
+
*new_example_specification.c*
+
*new_example.c*

. Add the Win32 run-time support files from the GUIX Studio installation path *_./win32_runtime_*. This includes the ThreadX and GUIX Win32 header and run-time library files.
. Add the GUIX Win32 library (*_gx.lib_*) to the project
. Add the ThreadX Win32 library (*_tx.lib_*) to the project
. Compile, Link, and Run the application!
